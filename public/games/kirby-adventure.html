<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Kirby Adventure - Andy's Fun Zone! üå∏</title>
  <link rel='stylesheet' href='../css/styles.css'>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, system-ui;
      background: linear-gradient(135deg, #ffb3d9 0%, #ff80cc 50%, #ff4db3 100%);
      color: #fff;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .game-header {
      text-align: center;
      padding: 1rem;
      background: linear-gradient(45deg, #ff69b4, #ffb6c1, #87ceeb);
      width: 100%;
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
    }
    
    .game-header h1 {
      color: #ff1493;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-size: 2.5rem;
    }
    
    .game-container {
      background: linear-gradient(135deg, #000428 0%, #004e92 100%);
      border: 3px solid #ff69b4;
      padding: 20px;
      margin: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(255, 105, 180, 0.4);
    }
    
    #gameCanvas {
      background: #000;
      border: 2px solid #ff69b4;
      display: block;
      border-radius: 10px;
    }
    
    .game-info {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      color: #ffb6c1;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    
    .controls {
      text-align: center;
      margin: 10px 0;
    }
    
    .game-button {
      background: linear-gradient(45deg, #ff69b4, #ff1493);
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
      transition: all 0.3s ease;
    }
    
    .game-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 105, 180, 0.5);
    }
  </style>
</head>
<body>
  <a href="../index.html" class="back-button">üè† Back to Home</a>
  
  <div class="game-header">
    <h1>üå∏ KIRBY ADVENTURE üå∏</h1>
    <p>Help Kirby collect Star Pieces while avoiding Dream Land enemies!</p>
  </div>
  
  <div class="game-container">
    <div class="game-info">
      <div>‚≠ê Stars: <span id="score">0</span></div>
      <div>üíñ Lives: <span id="lives">3</span></div>
      <div>üåü Level: <span id="level">1</span></div>
    </div>
    
    <canvas id="gameCanvas" width="600" height="600"></canvas>
    
    <div class="controls">
      <button class="game-button" onclick="startGame()">üéÆ Start Game</button>
      <button class="game-button" onclick="resetGame()">üîÑ Reset</button>
      <button class="game-button" onclick="pauseGame()">‚è∏Ô∏è Pause</button>
    </div>
  </div>
  
  <script>
    // Game variables
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let gameState = 'menu'; // menu, playing, paused, gameOver
    let score = 0;
    let lives = 3;
    let level = 1;
    let gameRunning = false;
    
    // Grid settings
    const GRID_SIZE = 20;
    const COLS = canvas.width / GRID_SIZE;
    const ROWS = canvas.height / GRID_SIZE;
    
    // Pac-Man
    const pacman = {
      x: 14,
      y: 27,
      direction: 'right',
      nextDirection: 'right',
      mouthOpen: true,
      animationTimer: 0
    };
    
    // Power-up state
    let powerMode = false;
    let powerModeTimer = 0;
    const POWER_MODE_DURATION = 300; // 300 game ticks
    
    // Simple maze layout (1 = wall, 0 = dot, 2 = power pellet, 3 = empty)
    const maze = [
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,2,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,2,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,1,1],
      [0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0],
      [1,1,1,1,1,1,0,1,1,0,1,1,3,3,3,3,3,3,1,1,0,1,1,0,1,1,1,1,1,1],
      [0,0,0,0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,1,0,0,0,0,0,0,0,0,0,0],
      [1,1,1,1,1,1,0,1,1,0,1,3,3,3,3,3,3,3,3,1,0,1,1,0,1,1,1,1,1,1],
      [0,0,0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,0,0,0,0,0],
      [1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,0,1],
      [1,2,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,2,1],
      [1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,2,1,1,1,1,0,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,0,1,1,1,1,2,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ];
    
    // Kirby Enemies
    const enemies = [
      { x: 14, y: 11, direction: 'up', color: '#ff6b35', name: 'Waddle Dee', emoji: 'üß°' },
      { x: 13, y: 11, direction: 'up', color: '#4169e1', name: 'King Dedede', emoji: 'üëë' },
      { x: 15, y: 11, direction: 'down', color: '#2e2e5e', name: 'Meta Knight', emoji: '‚öîÔ∏è' },
      { x: 16, y: 11, direction: 'down', color: '#8a2be2', name: 'Marx', emoji: 'üé≠' }
    ];
    
    // Game functions
    function startGame() {
      gameState = 'playing';
      gameRunning = true;
      gameLoop();
    }
    
    function resetGame() {
      score = 0;
      lives = 3;
      level = 1;
      gameState = 'menu';
      gameRunning = false;
      
      // Reset Pac-Man position
      pacman.x = 14;
      pacman.y = 27;
      pacman.direction = 'right';
      
      // Reset power mode
      powerMode = false;
      powerModeTimer = 0;
      
      // Reset enemies
      enemies[0].x = 14; enemies[0].y = 11;
      enemies[1].x = 13; enemies[1].y = 11;
      enemies[2].x = 15; enemies[2].y = 11;
      enemies[3].x = 16; enemies[3].y = 11;
      
      updateScore();
      draw();
    }
    
    function pauseGame() {
      if (gameState === 'playing') {
        gameState = 'paused';
        gameRunning = false;
      } else if (gameState === 'paused') {
        gameState = 'playing';
        gameRunning = true;
        gameLoop();
      }
    }
    
    function updateScore() {
      document.getElementById('score').textContent = score;
      document.getElementById('lives').textContent = lives;
      document.getElementById('level').textContent = level;
    }
    
    function drawMaze() {
      for (let row = 0; row < maze.length; row++) {
        for (let col = 0; col < maze[row].length; col++) {
          const x = col * GRID_SIZE;
          const y = row * GRID_SIZE;
          
          if (maze[row][col] === 1) {
            // Wall
            ctx.fillStyle = '#0000ff';
            ctx.fillRect(x, y, GRID_SIZE, GRID_SIZE);
          } else if (maze[row][col] === 0) {
            // Star Piece
            ctx.fillStyle = '#ffd700';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‚≠ê', x + GRID_SIZE/2, y + GRID_SIZE/2 + 3);
          } else if (maze[row][col] === 2) {
            // Maxim Tomato (power-up)
            ctx.fillStyle = '#ff6347';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üçÖ', x + GRID_SIZE/2, y + GRID_SIZE/2 + 4);
          }
        }
      }
    }
    
    function drawKirby() {
      const x = pacman.x * GRID_SIZE + GRID_SIZE/2;
      const y = pacman.y * GRID_SIZE + GRID_SIZE/2;
      
      // Draw Kirby's pink body
      ctx.fillStyle = '#ffb6c1';
      ctx.beginPath();
      ctx.arc(x, y, GRID_SIZE/2 - 2, 0, 2 * Math.PI);
      ctx.fill();
      
      // Draw Kirby's face
      ctx.fillStyle = '#000';
      
      // Eyes
      if (pacman.mouthOpen) {
        // Blinking/happy eyes
        ctx.fillRect(x - 5, y - 4, 3, 2);
        ctx.fillRect(x + 2, y - 4, 3, 2);
      } else {
        // Normal round eyes
        ctx.beginPath();
        ctx.arc(x - 3, y - 4, 1.5, 0, Math.PI * 2);
        ctx.arc(x + 3, y - 4, 1.5, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Mouth (based on direction)
      ctx.fillStyle = '#000';
      if (pacman.direction === 'right' && pacman.mouthOpen) {
        ctx.fillRect(x + 2, y + 2, 4, 2);
      } else if (pacman.direction === 'left' && pacman.mouthOpen) {
        ctx.fillRect(x - 6, y + 2, 4, 2);
      } else {
        // Small smile
        ctx.beginPath();
        ctx.arc(x, y + 3, 2, 0, Math.PI);
        ctx.lineWidth = 1;
        ctx.stroke();
      }
      
      // Rosy cheeks
      ctx.fillStyle = '#ff69b4';
      ctx.beginPath();
      ctx.arc(x - 6, y + 1, 1, 0, Math.PI * 2);
      ctx.arc(x + 6, y + 1, 1, 0, Math.PI * 2);
      ctx.fill();
    }
    
    function drawEnemies() {
      enemies.forEach(enemy => {
        const x = enemy.x * GRID_SIZE + GRID_SIZE/2;
        const y = enemy.y * GRID_SIZE + GRID_SIZE/2;
        
        if (enemy.vulnerable) {
          // Draw vulnerable enemy (light blue, scared)
          ctx.fillStyle = '#87ceeb';
          ctx.beginPath();
          ctx.arc(x, y, GRID_SIZE/2 - 2, 0, 2 * Math.PI);
          ctx.fill();
          
          // Scared face
          ctx.fillStyle = '#000';
          ctx.font = '8px Arial';
          ctx.textAlign = 'center';
          ctx.fillText('üò∞', x, y + 2);
        } else {
          // Draw normal enemy with their shape and color
          ctx.fillStyle = enemy.color;
          
          if (enemy.name === 'Waddle Dee') {
            // Round orange enemy
            ctx.beginPath();
            ctx.arc(x, y, GRID_SIZE/2 - 2, 0, 2 * Math.PI);
            ctx.fill();
            // Simple face
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(x - 2, y - 2, 1, 0, Math.PI * 2);
            ctx.arc(x + 2, y - 2, 1, 0, Math.PI * 2);
            ctx.fill();
          } else if (enemy.name === 'King Dedede') {
            // Larger, regal enemy
            ctx.beginPath();
            ctx.arc(x, y, GRID_SIZE/2 - 1, 0, 2 * Math.PI);
            ctx.fill();
            // Crown emoji
            ctx.font = '12px Arial';
            ctx.fillText('üëë', x, y - 6);
          } else if (enemy.name === 'Meta Knight') {
            // Dark, knight-like enemy
            ctx.beginPath();
            ctx.arc(x, y, GRID_SIZE/2 - 2, 0, 2 * Math.PI);
            ctx.fill();
            // Sword
            ctx.font = '10px Arial';
            ctx.fillText('‚öîÔ∏è', x, y + 2);
          } else if (enemy.name === 'Marx') {
            // Jester-like enemy
            ctx.beginPath();
            ctx.arc(x, y, GRID_SIZE/2 - 2, 0, 2 * Math.PI);
            ctx.fill();
            // Jester face
            ctx.font = '10px Arial';
            ctx.fillText('üé≠', x, y + 2);
          }
        }
      });
    }
    
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawMaze();
      drawKirby();
      drawEnemies();
      
      if (gameState === 'paused') {
        ctx.fillStyle = 'rgba(0,0,0,0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#ffff00';
        ctx.font = '48px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('PAUSED', canvas.width/2, canvas.height/2);
      }
    }
    
    function canMoveTo(x, y) {
      if (x < 0 || x >= COLS || y < 0 || y >= ROWS) return false;
      return maze[y][x] !== 1;
    }
    
    function movePacman() {
      let newX = pacman.x;
      let newY = pacman.y;
      
      // Try to change direction
      if (pacman.nextDirection !== pacman.direction) {
        let testX = pacman.x;
        let testY = pacman.y;
        
        if (pacman.nextDirection === 'up') testY--;
        else if (pacman.nextDirection === 'down') testY++;
        else if (pacman.nextDirection === 'left') testX--;
        else if (pacman.nextDirection === 'right') testX++;
        
        if (canMoveTo(testX, testY)) {
          pacman.direction = pacman.nextDirection;
        }
      }
      
      // Move in current direction
      if (pacman.direction === 'up') newY--;
      else if (pacman.direction === 'down') newY++;
      else if (pacman.direction === 'left') newX--;
      else if (pacman.direction === 'right') newX++;
      
      if (canMoveTo(newX, newY)) {
        pacman.x = newX;
        pacman.y = newY;
        
        // Check for dots
        if (maze[pacman.y][pacman.x] === 0) {
          maze[pacman.y][pacman.x] = 3;
          score += 10;
          updateScore();
        } else if (maze[pacman.y][pacman.x] === 2) {
          maze[pacman.y][pacman.x] = 3;
          score += 50;
          powerMode = true;
          powerModeTimer = POWER_MODE_DURATION;
          // Make enemies vulnerable (Kirby can inhale them!)
          enemies.forEach(enemy => {
            enemy.vulnerable = true;
            enemy.originalColor = enemy.color;
            enemy.color = '#87ceeb';
          });
          updateScore();
        }
      }
      
      // Animate mouth
      pacman.animationTimer++;
      if (pacman.animationTimer % 10 === 0) {
        pacman.mouthOpen = !pacman.mouthOpen;
      }
    }
    
    function moveEnemies() {
      enemies.forEach(enemy => {
        // Simple AI - random direction changes
        if (Math.random() < 0.1) {
          const directions = ['up', 'down', 'left', 'right'];
          enemy.direction = directions[Math.floor(Math.random() * directions.length)];
        }
        
        let newX = enemy.x;
        let newY = enemy.y;
        
        if (enemy.direction === 'up') newY--;
        else if (enemy.direction === 'down') newY++;
        else if (enemy.direction === 'left') newX--;
        else if (enemy.direction === 'right') newX++;
        
        if (canMoveTo(newX, newY)) {
          enemy.x = newX;
          enemy.y = newY;
        } else {
          // Change direction if hit wall
          const directions = ['up', 'down', 'left', 'right'];
          enemy.direction = directions[Math.floor(Math.random() * directions.length)];
        }
      });
    }
    
    function updatePowerMode() {
      if (powerMode) {
        powerModeTimer--;
        if (powerModeTimer <= 0) {
          powerMode = false;
          // Reset enemies to normal
          enemies.forEach(enemy => {
            enemy.vulnerable = false;
            enemy.color = enemy.originalColor || enemy.color;
          });
        }
      }
    }
    
    function checkCollisions() {
      enemies.forEach((enemy, index) => {
        // Check for collision (same position)
        if (enemy.x === pacman.x && enemy.y === pacman.y) {
          if (powerMode && enemy.vulnerable) {
            // Kirby inhales the enemy!
            score += 200;
            updateScore();
            // Reset enemy to center
            enemy.x = 14 + (index % 2);
            enemy.y = 11;
            enemy.vulnerable = false;
            enemy.color = enemy.originalColor;
            // Show copy ability message (removed popup for smoother gameplay)
          } else {
            // Kirby loses a life
            lives--;
            updateScore();
            
            if (lives <= 0) {
              gameState = 'gameOver';
              gameRunning = false;
              console.log('Game Over! Kirby needs more practice! Final Score: ' + score);
            } else {
              // Reset positions
              pacman.x = 14;
              pacman.y = 27;
              powerMode = false;
              powerModeTimer = 0;
              console.log('Ouch! Kirby lost a life! Lives remaining: ' + lives);
            }
          }
        }
      });
    }
    
    function gameLoop() {
      if (!gameRunning || gameState !== 'playing') return;
      
      updatePowerMode();
      movePacman();
      checkCollisions(); // Check after Kirby moves
      moveEnemies();
      checkCollisions(); // Check after enemies move
      draw();
      
      setTimeout(gameLoop, 200);
    }
    
    // Keyboard controls
    document.addEventListener('keydown', function(e) {
      if (gameState !== 'playing') return;
      
      switch (e.key) {
        case 'ArrowUp':
        case 'w':
        case 'W':
          pacman.nextDirection = 'up';
          e.preventDefault();
          break;
        case 'ArrowDown':
        case 's':
        case 'S':
          pacman.nextDirection = 'down';
          e.preventDefault();
          break;
        case 'ArrowLeft':
        case 'a':
        case 'A':
          pacman.nextDirection = 'left';
          e.preventDefault();
          break;
        case 'ArrowRight':
        case 'd':
        case 'D':
          pacman.nextDirection = 'right';
          e.preventDefault();
          break;
      }
    });
    
    // Initialize game
    updateScore();
    draw();
  </script>
</body>
</html>
